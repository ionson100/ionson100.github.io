"use strict";(self.webpackChunkionson100_github_io=self.webpackChunkionson100_github_io||[]).push([[4053],{42324:(e,t,i)=>{i.d(t,{m:()=>$e,s:()=>et});var n=i(54705),o=i(65043),s=i(32940),r=i(64773),a=i(27991),h=i(29573),l=i(96404),d=i(12812),c=i(90422),u=i(79918),g=i(63104),p=i(79649),f=i(35366),_=i(32347),m=i(69043),y=i(45921),v=i(56803),C=i(18624),w=i(39871);const x="select";class F extends u.Ay{constructor(e,t,i,n){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=n}}const P={};class E extends p.Ay{constructor(e){let t;if(super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:w.t5,this.addCondition_=e.addCondition?e.addCondition:w.Zm,this.removeCondition_=e.removeCondition?e.removeCondition:w.Zm,this.toggleCondition_=e.toggleCondition?e.toggleCondition:w.Kg,this.multi_=!!e.multi&&e.multi,this.filter_=e.filter?e.filter:_.rT,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=void 0!==e.style?e.style:function(){const e=(0,y.mY)();return(0,v.X$)(e.Polygon,e.LineString),(0,v.X$)(e.GeometryCollection,e.LineString),function(t){return t.getGeometry()?e[t.getGeometry().getType()]:null}}(),this.features_=e.features||new d.A,e.layers)if("function"===typeof e.layers)t=e.layers;else{const i=e.layers;t=function(e){return i.includes(e)}}else t=_.rT;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[(0,C.v6)(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[(0,C.v6)(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(c.A.ADD,this.boundAddFeature_),this.features_.addEventListener(c.A.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(c.A.ADD,this.boundAddFeature_),this.features_.removeEventListener(c.A.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const e=this.getMap().getAllLayers().find((function(e){if(e instanceof f.A&&e.getSource()&&e.getSource().hasFeature(t))return e}));e&&this.addFeatureLayerAssociation_(t,e)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){const t=(0,C.v6)(e);t in P||(P[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let n=t.length-1;n>=0;--n){const i=t[n];if(i!==this&&i instanceof E&&i.getStyle()&&-1!==i.getFeatures().getArray().lastIndexOf(e))return void e.setStyle(i.getStyle())}const i=(0,C.v6)(e);e.setStyle(P[i]),delete P[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[(0,C.v6)(e)]}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),i=this.removeCondition_(e),n=this.toggleCondition_(e),o=!t&&!i&&!n,s=e.map,r=this.getFeatures(),a=[],h=[];if(o){(0,m.I)(this.featureLayerAssociation_),s.forEachFeatureAtPixel(e.pixel,((e,t)=>{if(e instanceof g.A&&this.filter_(e,t))return this.addFeatureLayerAssociation_(e,t),h.push(e),!this.multi_}),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=r.getLength()-1;e>=0;--e){const t=r.item(e),i=h.indexOf(t);i>-1?h.splice(i,1):(r.remove(t),a.push(t))}0!==h.length&&r.extend(h)}else{s.forEachFeatureAtPixel(e.pixel,((e,o)=>{if(e instanceof g.A&&this.filter_(e,o))return!t&&!n||r.getArray().includes(e)?(i||n)&&r.getArray().includes(e)&&(a.push(e),this.removeFeatureLayerAssociation_(e)):(this.addFeatureLayerAssociation_(e,o),h.push(e)),!this.multi_}),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let e=a.length-1;e>=0;--e)r.remove(a[e]);r.extend(h)}return(h.length>0||a.length>0)&&this.dispatchEvent(new F(x,h,a,e)),!0}}const S=E;var A=i(9433),T=i(20892),k=i(13960),M=i(25539);class L extends A.Ay{constructor(e,t,i){super(),void 0!==i&&void 0===t?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new L(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const o=this.flatCoordinates,s=e-o[0],r=t-o[1],a=s*s+r*r;if(a<n){if(0===a)for(let e=0;e<this.stride;++e)i[e]=o[e];else{const e=this.getRadius()/Math.sqrt(a);i[0]=o[0]+e*s,i[1]=o[1]+e*r;for(let t=2;t<this.stride;++t)i[t]=o[t]}return i.length=this.stride,a}return n}containsXY(e,t){const i=this.flatCoordinates,n=e-i[0],o=t-i[1];return n*n+o*o<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return(0,T.N)(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if((0,T.HY)(e,t)){const t=this.getCenter();return e[0]<=t[0]&&e[2]>=t[0]||(e[1]<=t[1]&&e[3]>=t[1]||(0,T.sB)(e,this.intersectsCoordinate.bind(this)))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+i;for(let o=1;o<t;++o)n[t+o]=e[o];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let o=(0,k._n)(n,0,e,this.stride);n[o++]=n[0]+t;for(let s=1,r=this.stride;s<r;++s)n[o++]=n[s];n.length=o,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter((0,M.e$)(i,0,i.length,n,e,t,i)),this.changed()}}L.prototype.transform;const D=L;var I=i(74470),G=i(99139),b=i(59088),R=i(85424),O=i(23716),V=i(82876),N=i(35685),U=i(64410),B=i(2082),j=i(43241),q=i(60984),H=i(38770),z=i(8386),X=i(79312);const Y="drawstart",Z="drawend",J="drawabort";class W extends u.Ay{constructor(e,t){super(e),this.feature=t}}function K(e,t){return(0,H.hG)(e[0],e[1],t[0],t[1])}function $(e,t){const i=e.length;return t<0?e[t+i]:t>=i?e[t-i]:e[t]}function Q(e,t,i){let n,o;t<i?(n=t,o=i):(n=i,o=t);const s=Math.ceil(n),r=Math.floor(o);if(s>r){return K(se(e,n),se(e,o))}let a=0;if(n<s){a+=K(se(e,n),$(e,s))}if(r<o){a+=K($(e,r),se(e,o))}for(let h=s;h<r-1;++h){a+=K($(e,h),$(e,h+1))}return a}function ee(e,t,i){if(t instanceof R.A)ie(e,t.getCoordinates(),!1,i);else if(t instanceof N.A){const n=t.getCoordinates();for(let t=0,o=n.length;t<o;++t)ie(e,n[t],!1,i)}else if(t instanceof q.Ay){const n=t.getCoordinates();for(let t=0,o=n.length;t<o;++t)ie(e,n[t],!0,i)}else if(t instanceof B.A){const n=t.getCoordinates();for(let t=0,o=n.length;t<o;++t){const o=n[t];for(let t=0,n=o.length;t<n;++t)ie(e,o[t],!0,i)}}else if(t instanceof G.A){const n=t.getGeometries();for(let t=0;t<n.length;++t)ee(e,n[t],i)}else;}const te={index:-1,endIndex:NaN};function ie(e,t,i,n){const o=e[0],s=e[1];for(let r=0,a=t.length-1;r<a;++r){const e=oe(o,s,t[r],t[r+1]);if(0===e.squaredDistance){const o=r+e.along;return void n.push({coordinates:t,ring:i,startIndex:o,endIndex:o})}}}const ne={along:0,squaredDistance:0};function oe(e,t,i,n){const o=i[0],s=i[1],r=n[0]-o,a=n[1]-s;let h=0,l=o,d=s;return 0===r&&0===a||(h=(0,H.qE)(((e-o)*r+(t-s)*a)/(r*r+a*a),0,1),l+=r*h,d+=a*h),ne.along=h,ne.squaredDistance=(0,H.Mg)((0,H.hG)(e,t,l,d),10),ne}function se(e,t){const i=e.length;let n=Math.floor(t);const o=t-n;n>=i?n-=i:n<0&&(n+=i);let s=n+1;s>=i&&(s-=i);const r=e[n],a=r[0],h=r[1],l=e[s];return[a+(l[0]-a)*o,h+(l[1]-h)*o]}class re extends l.A{constructor(e){const t=e;t.stopDown||(t.stopDown=_.W8),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=function(e){switch(e){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+e)}}(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:"Polygon"===this.mode_?3:2,this.maxPoints_="Circle"===this.mode_?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:_.rT,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const e=this.mode_;if("Circle"===e)i=(e,t,i)=>{const n=t||new D([NaN,NaN]),o=(0,X.Ad)(e[0],i),s=(0,z.hG)(o,(0,X.Ad)(e[e.length-1],i));n.setCenterAndRadius(o,Math.sqrt(s),this.geometryLayout_);const r=(0,X.Tf)();return r&&n.transform(i,r),n};else{let t;"Point"===e?t=j.A:"LineString"===e?t=R.A:"Polygon"===e&&(t=q.Ay),i=(i,n,o)=>(n?"Polygon"===e?i[0].length?n.setCoordinates([i[0].concat([i[0][0]])],this.geometryLayout_):n.setCoordinates([],this.geometryLayout_):n.setCoordinates(i,this.geometryLayout_):n=new t(i,this.geometryLayout_),n)}}this.geometryFunction_=i,this.dragVertexDelay_=void 0!==e.dragVertexDelay?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new f.A({source:new a.A({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style?e.style:ae(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:w.TS,this.freehandCondition_,e.freehand?this.freehandCondition_=w.Gk:this.freehandCondition_=e.freehandCondition?e.freehandCondition:w.Kg,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(b.A.ACTIVE,this.updateState_)}setTrace(e){let t;t=e?!0===e?w.Gk:e:w.Zm,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===I.A.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_="Point"!==this.mode_&&this.freehandCondition_(e);let t=e.type===V.A.POINTERMOVE,i=!0;if(!this.freehand_&&this.lastDragTime_&&e.type===V.A.POINTERDRAG){Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&void 0!==this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)}return this.freehand_&&e.type===V.A.POINTERDRAG&&null!==this.sketchFeature_?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===V.A.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===V.A.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):("mouse"===e.originalEvent.pointerType||e.type===V.A.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(e)):e.type===V.A.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout((()=>{this.handlePointerMove_(new O.A(V.A.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))}),this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active)return void this.deactivateTrace_();const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),n=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),o=(0,T.Tr)([i,n]),s=this.traceSource_.getFeaturesInExtent(o);if(0===s.length)return;const r=function(e,t){const i=[];for(let n=0;n<t.length;++n)ee(e,t[n].getGeometry(),i);return i}(e.coordinate,s);r.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:r,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex;i===e.startIndex<=t?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const n=Math.ceil(e);let o=Math.floor(t);o===t&&(o-=1),i=o-n+1}else{const n=Math.floor(e);let o=Math.ceil(t);o===t&&(o+=1),i=n-o+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const n=[];if(t<i){const o=Math.ceil(t);let s=Math.floor(i);s===i&&(s-=1);for(let t=o;t<=s;++t)n.push($(e.coordinates,t))}else{const o=Math.floor(t);let s=Math.ceil(i);s===i&&(s+=1);for(let t=o;t>=s;--t)n.push($(e.coordinates,t))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(-1===t.targetIndex&&(0,z.Io)(t.startPx,e.pixel)<this.snapTolerance_)return;const i=function(e,t,i,n){const o=e[0],s=e[1];let r=1/0,a=-1,h=NaN;for(let c=0;c<t.targets.length;++c){const e=t.targets[c],i=e.coordinates;let n,l=1/0;for(let t=0;t<i.length-1;++t){const e=oe(o,s,i[t],i[t+1]);e.squaredDistance<l&&(l=e.squaredDistance,n=t+e.along)}l<r&&(r=l,e.ring&&t.targetIndex===c&&(e.endIndex>e.startIndex?n<e.startIndex&&(n+=i.length):e.endIndex<e.startIndex&&n>e.startIndex&&(n-=i.length)),h=n,a=c)}const l=t.targets[a];let d=l.ring;if(t.targetIndex===a&&d){const e=se(l.coordinates,h),o=i.getPixelFromCoordinate(e);(0,z.Io)(o,t.startPx)>n&&(d=!1)}if(d){const e=l.coordinates,t=e.length,i=l.startIndex,n=h;if(i<n){const o=Q(e,i,n);Q(e,i,n-t)<o&&(h-=t)}else{const o=Q(e,i,n);Q(e,i,n+t)<o&&(h+=t)}}return te.index=a,te.endIndex=h,te}(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(-1!==t.targetIndex){const e=t.targets[t.targetIndex];this.removeTracedCoordinates_(e.startIndex,e.endIndex)}const e=t.targets[i.index];this.addTracedCoordinates_(e,e.startIndex,i.endIndex)}else{const e=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(e,i.endIndex)}t.targetIndex=i.index;const n=t.targets[t.targetIndex];n.endIndex=i.endIndex;const o=se(n.coordinates,n.endIndex),s=this.getMap().getPixelFromCoordinate(o);e.coordinate=o,e.pixel=[Math.round(s[0]),Math.round(s[1])]}handleUpEvent(e){let t=!0;if(0===this.getPointerCount()){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():this.freehand_||n&&"Point"!==this.mode_||(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,n=t[0]-i[0],o=t[1]-i[1],s=n*n+o*o;if(this.shouldHandle_=this.freehand_?s>this.squaredClickTolerance_:s<=this.squaredClickTolerance_,!this.shouldHandle_)return}this.finishCoordinate_?(this.updateTrace_(e),this.modifyDrawing_(e.coordinate)):this.createOrUpdateSketchPoint_(e.coordinate.slice())}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let n=!1,o=[this.finishCoordinate_];const s=this.mode_;if("Point"===s)i=!0;else if("Circle"===s)i=2===this.sketchCoords_.length;else if("LineString"===s)n=!t&&this.sketchCoords_.length>this.minPoints_;else if("Polygon"===s){const e=this.sketchCoords_;n=e[0].length>this.minPoints_,o=[e[0][0],e[0][e[0].length-2]],o=t?[e[0][0]]:[e[0][0],e[0][e[0].length-2]]}if(n){const t=this.getMap();for(let n=0,s=o.length;n<s;n++){const s=o[n],r=t.getPixelFromCoordinate(s),a=e[0]-r[0],h=e[1]-r[1],l=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(a*a+h*h)<=l,i){this.finishCoordinate_=s;break}}}}return i}createOrUpdateSketchPoint_(e){if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(e)}else this.sketchPoint_=new g.A(new j.A(e)),this.updateSketchFeatures_()}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new g.A);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new R.A(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=(0,A.dn)(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,"Point"===this.mode_?this.sketchCoords_=e.slice():"Polygon"===this.mode_?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new g.A(new R.A(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new g.A,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new W(Y,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),o=(0,A.dn)(this.geometryLayout_);let s,r;for(;e.length<o;)e.push(0);if("Point"===this.mode_?r=this.sketchCoords_:"Polygon"===this.mode_?(s=this.sketchCoords_[0],r=s[s.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(s=this.sketchCoords_,r=s[s.length-1]),r[0]=e[0],r[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(e)}if("Polygon"===i.getType()&&"Polygon"!==this.mode_)this.createOrUpdateCustomSketchLine_(i);else if(this.sketchLineCoords_){this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_)}this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,o;const s=this.mode_;return"LineString"===s||"Circle"===s?(this.finishCoordinate_=e.slice(),o=this.sketchCoords_,o.length>=this.maxPoints_&&(this.freehand_?o.pop():n=!0),o.push(e.slice()),this.geometryFunction_(o,t,i)):"Polygon"===s&&(o=this.sketchCoords_[0],o.length>=this.maxPoints_&&(this.freehand_?o.pop():n=!0),o.push(e.slice()),n&&(this.finishCoordinate_=o[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let o=0;o<e;++o){let e;if("LineString"===n||"Circle"===n){if(e=this.sketchCoords_,e.splice(-2,1),e.length>=2){this.finishCoordinate_=e[e.length-2].slice();const t=this.finishCoordinate_.slice();e[e.length-1]=t,this.createOrUpdateSketchPoint_(t)}this.geometryFunction_(e,t,i),"Polygon"===t.getType()&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if("Polygon"===n){e=this.sketchCoords_[0],e.splice(-2,1);const n=this.sketchLine_.getGeometry();if(e.length>=2){const t=e[e.length-2].slice();e[e.length-1]=t,this.createOrUpdateSketchPoint_(t)}n.setCoordinates(e),this.geometryFunction_(this.sketchCoords_,t,i)}if(1===e.length){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),n=this.getMap().getView().getProjection();return"LineString"===this.mode_?(t.pop(),this.geometryFunction_(t,i,n)):"Polygon"===this.mode_&&(t[0].pop(),this.geometryFunction_(t,i,n),t=i.getCoordinates()),"MultiPoint"===this.type_?e.setGeometry(new U.A([t])):"MultiLineString"===this.type_?e.setGeometry(new N.A([t])):"MultiPolygon"===this.type_&&e.setGeometry(new B.A([t])),this.dispatchEvent(new W(Z,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new W(J,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;let n;if(i&&this.startDrawing_(e[0]),"LineString"===t||"Circle"===t)n=this.sketchCoords_;else{if("Polygon"!==t)return;n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[]}i&&n.shift(),n.pop();for(let s=0;s<e.length;s++)this.addToDrawing_(e[s]);const o=e[e.length-1];this.sketchFeature_=this.addToDrawing_(o),this.modifyDrawing_(o)}extend(e){const t=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=t.getCoordinates();const i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice(),this.sketchCoords_.push(i.slice()),this.sketchPoint_=new g.A(new j.A(i)),this.updateSketchFeatures_(),this.dispatchEvent(new W(Y,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();e&&t||this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function ae(){const e=(0,y.mY)();return function(t,i){return e[t.getGeometry().getType()]}}const he=re;var le=i(29303),de=i(32879),ce=i(22371);const ue=[0,0,0,0],ge=[],pe="modifystart",fe="modifyend";class _e extends u.Ay{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class me extends l.A{constructor(e){let t;if(super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:w.fs,this.defaultDeleteCondition_=function(e){return(0,w.Js)(e)&&(0,w.t5)(e)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:w.Gk,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new de.A,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new f.A({source:new a.A({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:we(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null,e.features?t=e.features:e.source&&(this.source_=e.source,t=new d.A(this.source_.getFeatures()),this.source_.addEventListener(ce.A.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(ce.A.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(c.A.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(c.A.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=void 0===e.snapToPointer?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const i=this.SEGMENT_WRITERS_[t.getType()];i&&i(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i),e.addEventListener(I.A.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new d.A;const i=this.featuresBeingModified_.getArray();for(let e=0,n=t.length;e<n;++e){const n=t[e];for(let e=0,t=n.length;e<t;++e){const t=n[e].feature;t&&!i.includes(t)&&this.featuresBeingModified_.push(t)}}0===this.featuresBeingModified_.getLength()?this.featuresBeingModified_=null:this.dispatchEvent(new _e(pe,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(I.A.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach((function(t){e===t.feature&&i.push(t)}));for(let n=i.length-1;n>=0;--n){const e=i[n];for(let t=this.dragSegments_.length-1;t>=0;--t)this.dragSegments_[t][0]===e&&this.dragSegments_.splice(t,1);t.remove(e)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let n=0,o=i.length;n<o;++n){const o=i[n],s={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),s)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,o=i.length-1;n<o;++n){const o=i.slice(n,n+2),s={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert((0,T.Tr)(o),s)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,o=i.length;n<o;++n){const o=i[n];for(let i=0,s=o.length-1;i<s;++i){const s=o.slice(i,i+2),r={feature:e,geometry:t,depth:[n],index:i,segment:s};this.rBush_.insert((0,T.Tr)(s),r)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,o=i.length;n<o;++n){const o=i[n];for(let i=0,s=o.length-1;i<s;++i){const s=o.slice(i,i+2),r={feature:e,geometry:t,depth:[n],index:i,segment:s};this.rBush_.insert((0,T.Tr)(s),r)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,o=i.length;n<o;++n){const o=i[n];for(let i=0,s=o.length;i<s;++i){const s=o[i];for(let o=0,r=s.length-1;o<r;++o){const r=s.slice(o,o+2),a={feature:e,geometry:t,depth:[i,n],index:o,segment:r};this.rBush_.insert((0,T.Tr)(r),a)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),n={feature:e,geometry:t,index:0,segment:[i,i]},o={feature:e,geometry:t,index:1,segment:[i,i]},s=[n,o];n.featureSegments=s,o.featureSegments=s,this.rBush_.insert((0,T.dP)(i),n);let r=t;const a=(0,X.Tf)();if(a&&this.getMap()){const e=this.getMap().getView().getProjection();r=r.clone().transform(a,e),r=(0,q.nD)(r).transform(e,a)}this.rBush_.insert(r.getExtent(),o)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const t=i[n];(0,this.SEGMENT_WRITERS_[t.getType()])(e,t)}}createOrUpdateVertexFeature_(e,t,i){let n=this.vertexFeature_;if(n){n.getGeometry().setCoordinates(e)}else n=new g.A(new j.A(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n);return n.set("features",t),n.set("geometries",i),n}handleEvent(e){if(!e.originalEvent)return!0;let t;return this.lastPointerEvent_=e,e.map.getView().getInteracting()||e.type!=V.A.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(t=!(e.type!=V.A.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint()),e.type==V.A.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_);const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],n=[];for(let o=0,s=this.dragSegments_.length;o<s;++o){const s=this.dragSegments_[o],r=s[0],a=r.feature;i.includes(a)||i.push(a);const h=r.geometry;n.includes(h)||n.push(h);const l=r.depth;let d;const c=r.segment,u=s[1];for(;t.length<h.getStride();)t.push(c[u][t.length]);switch(h.getType()){case"Point":d=t,c[0]=t,c[1]=t;break;case"MultiPoint":d=h.getCoordinates(),d[r.index]=t,c[0]=t,c[1]=t;break;case"LineString":d=h.getCoordinates(),d[r.index+u]=t,c[u]=t;break;case"MultiLineString":case"Polygon":d=h.getCoordinates(),d[l[0]][r.index+u]=t,c[u]=t;break;case"MultiPolygon":d=h.getCoordinates(),d[l[1]][l[0]][r.index+u]=t,c[u]=t;break;case"Circle":if(c[0]=t,c[1]=t,0===r.index)this.changingFeature_=!0,h.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0;const i=e.map.getView().getProjection();let n=(0,z.Io)((0,X.Ad)(h.getCenter(),i),(0,X.Ad)(t,i));const o=(0,X.Tf)();if(o){const e=h.clone().transform(o,i);e.setRadius(n),n=e.transform(i,o).getRadius()}h.setRadius(n),this.changingFeature_=!1}}d&&this.setGeometryCoordinates_(h,d)}this.createOrUpdateVertexFeature_(t,i,n)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate;this.handlePointerAtPixel_(e.pixel,e.map,t),this.dragSegments_.length=0,this.featuresBeingModified_=null;const i=this.vertexFeature_;if(i){const n=e.map.getView().getProjection(),o=[],s=i.getGeometry().getCoordinates(),r=(0,T.Tr)([s]),a=this.rBush_.getInExtent(r),h={};a.sort(ye);for(let i=0,l=a.length;i<l;++i){const r=a[i],l=r.segment;let d=(0,C.v6)(r.geometry);const c=r.depth;if(c&&(d+="-"+c.join("-")),h[d]||(h[d]=new Array(2)),"Circle"!==r.geometry.getType()||1!==r.index)if(!(0,z.aI)(l[0],s)||h[d][0])if(!(0,z.aI)(l[1],s)||h[d][1])(0,C.v6)(l)in this.vertexSegments_&&!h[d][0]&&!h[d][1]&&this.insertVertexCondition_(e)&&o.push(r);else{if(h[d][0]&&0===h[d][0].index){let e=r.geometry.getCoordinates();switch(r.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":e=e[c[1]];case"Polygon":if(r.index!==e[c[0]].length-2)continue}}this.dragSegments_.push([r,1]),h[d][1]=r}else this.dragSegments_.push([r,0]),h[d][0]=r;else{const e=Ce(t,r,n);(0,z.aI)(e,s)&&!h[d][0]&&(this.dragSegments_.push([r,0]),h[d][0]=r)}}o.length&&this.willModifyFeatures_(e,[o]);for(let e=o.length-1;e>=0;--e)this.insertVertex_(o[e],s)}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],n=i.geometry;if("Circle"===n.getType()){const t=n.getCenter(),o=i.featureSegments[0],s=i.featureSegments[1];o.segment[0]=t,o.segment[1]=t,s.segment[0]=t,s.segment[1]=t,this.rBush_.update((0,T.dP)(t),o);let r=n;const a=(0,X.Tf)();if(a){const t=e.map.getView().getProjection();r=r.clone().transform(a,t),r=(0,q.nD)(r).transform(t,a)}this.rBush_.update(r.getExtent(),s)}else this.rBush_.update((0,T.Tr)(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new _e(fe,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map,e.coordinate)}handlePointerAtPixel_(e,t,i){const n=i||t.getCoordinateFromPixel(e),o=t.getView().getProjection(),s=function(e,t){return ve(n,e,o)-ve(n,t,o)};let r,a;if(this.hitDetection_){const i="object"===typeof this.hitDetection_?e=>e===this.hitDetection_:void 0;t.forEachFeatureAtPixel(e,((e,t,i)=>{i&&"Point"===i.getType()&&(i=new j.A((0,X.te)(i.getCoordinates(),o)));const n=i||e.getGeometry();if(e instanceof g.A&&this.features_.getArray().includes(e)){a=n;const t=e.getGeometry().getFlatCoordinates().slice(0,2);r=[{feature:e,geometry:a,segment:[t,t]}]}return!0}),{layerFilter:i})}if(!r){const e=(0,X.SD)((0,T.dP)(n,ue),o),i=t.getView().getResolution()*this.pixelTolerance_,s=(0,X.JR)((0,T.r)(e,i,ue),o);r=this.rBush_.getInExtent(s)}if(r&&r.length>0){const i=r.sort(s)[0],h=i.segment;let l=Ce(n,i,o);const d=t.getPixelFromCoordinate(l);let c=(0,z.Io)(e,d);if(a||c<=this.pixelTolerance_){const e={};if(e[(0,C.v6)(h)]=!0,this.snapToPointer_||(this.delta_[0]=l[0]-n[0],this.delta_[1]=l[1]-n[1]),"Circle"===i.geometry.getType()&&1===i.index)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(l,[i.feature],[i.geometry]);else{const n=t.getPixelFromCoordinate(h[0]),o=t.getPixelFromCoordinate(h[1]),s=(0,z.hG)(d,n),a=(0,z.hG)(d,o);c=Math.sqrt(Math.min(s,a)),this.snappedToVertex_=c<=this.pixelTolerance_,this.snappedToVertex_&&(l=s>a?h[1]:h[0]),this.createOrUpdateVertexFeature_(l,[i.feature],[i.geometry]);const u={};u[(0,C.v6)(i.geometry)]=!0;for(let t=1,i=r.length;t<i;++t){const i=r[t].segment;if(!((0,z.aI)(h[0],i[0])&&(0,z.aI)(h[1],i[1])||(0,z.aI)(h[0],i[1])&&(0,z.aI)(h[1],i[0])))break;{const n=(0,C.v6)(r[t].geometry);n in u||(u[n]=!0,e[(0,C.v6)(i)]=!0)}}}return void(this.vertexSegments_=e)}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,n=e.feature,o=e.geometry,s=e.depth,r=e.index;let a;for(;t.length<o.getStride();)t.push(0);switch(o.getType()){case"MultiLineString":case"Polygon":a=o.getCoordinates(),a[s[0]].splice(r+1,0,t);break;case"MultiPolygon":a=o.getCoordinates(),a[s[1]][s[0]].splice(r+1,0,t);break;case"LineString":a=o.getCoordinates(),a.splice(r+1,0,t);break;default:return}this.setGeometryCoordinates_(o,a);const h=this.rBush_;h.remove(e),this.updateSegmentIndices_(o,r,s,1);const l={segment:[i[0],t],feature:n,geometry:o,depth:s,index:r};h.insert((0,T.Tr)(l.segment),l),this.dragSegments_.push([l,1]);const d={segment:[t,i[1]],feature:n,geometry:o,depth:s,index:r+1};h.insert((0,T.Tr)(d.segment),d),this.dragSegments_.push([d,0]),this.ignoreNextSingleClick_=!0}removePoint(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=V.A.POINTERDRAG){const e=this.lastPointerEvent_;this.willModifyFeatures_(e,this.dragSegments_);const t=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new _e(fe,this.featuresBeingModified_,e)),this.featuresBeingModified_=null,t}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i,n,o,s,r,a,h,l,d,c,u,g=!1;for(r=e.length-1;r>=0;--r)o=e[r],c=o[0],u=(0,C.v6)(c.feature),c.depth&&(u+="-"+c.depth.join("-")),u in t||(t[u]={}),0===o[1]?(t[u].right=c,t[u].index=c.index):1==o[1]&&(t[u].left=c,t[u].index=c.index+1);for(u in t){switch(d=t[u].right,h=t[u].left,a=t[u].index,l=a-1,c=void 0!==h?h:d,l<0&&(l=0),s=c.geometry,n=s.getCoordinates(),i=n,g=!1,s.getType()){case"MultiLineString":n[c.depth[0]].length>2&&(n[c.depth[0]].splice(a,1),g=!0);break;case"LineString":n.length>2&&(n.splice(a,1),g=!0);break;case"MultiPolygon":i=i[c.depth[1]];case"Polygon":i=i[c.depth[0]],i.length>4&&(a==i.length-1&&(a=0),i.splice(a,1),g=!0,0===a&&(i.pop(),i.push(i[0]),l=i.length-1))}if(g){this.setGeometryCoordinates_(s,n);const t=[];if(void 0!==h&&(this.rBush_.remove(h),t.push(h.segment[0])),void 0!==d&&(this.rBush_.remove(d),t.push(d.segment[1])),void 0!==h&&void 0!==d){const e={depth:c.depth,feature:c.feature,geometry:c.geometry,index:l,segment:t};this.rBush_.insert((0,T.Tr)(e.segment),e)}this.updateSegmentIndices_(s,a,c.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return g}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),(function(o){o.geometry===e&&(void 0===i||void 0===o.depth||(0,v.aI)(o.depth,i))&&o.index>t&&(o.index+=n)}))}}function ye(e,t){return e.index-t.index}function ve(e,t,i){const n=t.geometry;if("Circle"===n.getType()){let o=n;if(1===t.index){const t=(0,X.Tf)();t&&(o=o.clone().transform(t,i));const n=(0,z.hG)(o.getCenter(),(0,X.Ad)(e,i)),s=Math.sqrt(n)-o.getRadius();return s*s}}const o=(0,X.Ad)(e,i);return ge[0]=(0,X.Ad)(t.segment[0],i),ge[1]=(0,X.Ad)(t.segment[1],i),(0,z.$x)(o,ge)}function Ce(e,t,i){const n=t.geometry;if("Circle"===n.getType()&&1===t.index){let t=n;const o=(0,X.Tf)();return o&&(t=t.clone().transform(o,i)),(0,X.te)(t.getClosestPoint((0,X.Ad)(e,i)),i)}const o=(0,X.Ad)(e,i);return ge[0]=(0,X.Ad)(t.segment[0],i),ge[1]=(0,X.Ad)(t.segment[1],i),(0,X.te)((0,z.sG)(o,ge),i)}function we(){const e=(0,y.mY)();return function(t,i){return e.Point}}const xe=me;var Fe=i(75351),Pe=i(8211),Ee=i(74061),Se=i(66685),Ae=i(61247),Te=i(47790),ke=i(57442),Me=i(84391),Le=function(e,t){return Le=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])},Le(e,t)};function De(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}Le(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}"function"===typeof SuppressedError&&SuppressedError;for(var Ie,Ge=[],be=0;be<256;++be)Ge.push((be+256).toString(16).slice(1));var Re=new Uint8Array(16);function Oe(){if(!Ie&&!(Ie="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ie(Re)}var Ve={randomUUID:"undefined"!==typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ne(e,t,i){if(Ve.randomUUID&&!t&&!e)return Ve.randomUUID();var n=(e=e||{}).random||(e.rng||Oe)();return n[6]=15&n[6]|64,n[8]=63&n[8]|128,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(Ge[e[t+0]]+Ge[e[t+1]]+Ge[e[t+2]]+Ge[e[t+3]]+"-"+Ge[e[t+4]]+Ge[e[t+5]]+"-"+Ge[e[t+6]]+Ge[e[t+7]]+"-"+Ge[e[t+8]]+Ge[e[t+9]]+"-"+Ge[e[t+10]]+Ge[e[t+11]]+Ge[e[t+12]]+Ge[e[t+13]]+Ge[e[t+14]]+Ge[e[t+15]]).toLowerCase()}(n)}function Ue(e){var t,i;if(!(!0===(null===(t=e.activePointers[0])||void 0===t?void 0:t.shiftKey)&&!0===(null===(i=e.activePointers[0])||void 0===i?void 0:i.ctrlKey)))return null;const n=e.map.forEachFeatureAtPixel(e.pixel,(function(e){return e}));return n&&(this.coordinate_=e.coordinate,this.feature_=n),!!n}function Be(e){const t=e.coordinate[0]-this.coordinate_[0],i=e.coordinate[1]-this.coordinate_[1];this.feature_.getGeometry().translate(t,i),this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1],this.drag_=1}function je(){return this.drag_&&this.option.onDragEnd&&this.option.onDragEnd(this.bsrMap,this.feature_),this.drag_=null,this.coordinate_=null,this.feature_=null,!1}function qe(e){if(this.cursor_){const t=e.map.forEachFeatureAtPixel(e.pixel,(function(e){return e})),i=e.map.getTargetElement();t?i.style.cursor!==this.cursor_&&(this.previousCursor_=i.style.cursor,i.style.cursor=this.cursor_):void 0!==this.previousCursor_&&(i.style.cursor=this.previousCursor_,this.previousCursor_=void 0)}}class He extends l.A{constructor(e,t){super({handleDownEvent:Ue,handleDragEvent:Be,handleMoveEvent:qe,handleUpEvent:je}),this.bsrMap=e,this.option=t,this.coordinate_=null,this.cursor_="pointer",this.feature_=null,this.drag_=null,this.previousCursor_=void 0}}class ze{constructor(e){(0,n.A)(this,"styleFunction",(e=>this.styles[e.getGeometry().getType()])),(0,n.A)(this,"selectStyle",(()=>this.stylesSelect)),this.option=e,this.styles={},this.stylesSelect=void 0,this.refreshStyleSettings()}refreshStyleSettings(){var e,t,i,n,o,s,r,a,h,l,d,c,u,g,p,f,_,m,v,C,w,x,F,P,E,S,A,T,k,M;this.stylesSelect=new y.Ay({fill:new Ae.A({color:this.hexToRgbAEx(null!==(e=null===(t=this.option.style)||void 0===t?void 0:t.fillBodySelect)&&void 0!==e?e:"#F8F9F4")}),stroke:new Te.A({color:null!==(i=null===(n=this.option.style)||void 0===n?void 0:n.colorLineSelect)&&void 0!==i?i:"#f80622",width:null!==(o=null===(s=this.option.style)||void 0===s?void 0:s.widthLineSelect)&&void 0!==o?o:3}),image:new ke.A({radius:null!==(r=null===(a=this.option.style)||void 0===a?void 0:a.radiusPointSelect)&&void 0!==r?r:6,fill:new Ae.A({color:null!==(h=null===(l=this.option.style)||void 0===l?void 0:l.colorPointSelect)&&void 0!==h?h:"#b91818"})})}),this.styles={LineString:new y.Ay({fill:new Ae.A({color:"rgb(167,81,81)"}),stroke:new Te.A({color:null!==(d=null===(c=this.option.style)||void 0===c?void 0:c.colorLineString)&&void 0!==d?d:"#179a1c",width:null!==(u=null===(g=this.option.style)||void 0===g?void 0:g.widthLineString)&&void 0!==u?u:4}),image:new ke.A({radius:7,fill:new Ae.A({color:"#ffcc33"})})}),Polygon:new y.Ay({fill:new Ae.A({color:this.hexToRgbAEx(null!==(p=null===(f=this.option.style)||void 0===f?void 0:f.fillPolygon)&&void 0!==p?p:"#F8F9F4")}),stroke:new Te.A({color:null!==(_=null===(m=this.option.style)||void 0===m?void 0:m.colorPolygon)&&void 0!==_?_:"#07720d",width:null!==(v=null===(C=this.option.style)||void 0===C?void 0:C.widthPolygon)&&void 0!==v?v:3}),image:new ke.A({radius:7,fill:new Ae.A({color:"#ffcc33"})})}),Circle:new y.Ay({fill:new Ae.A({color:this.hexToRgbAEx(null!==(w=null===(x=this.option.style)||void 0===x?void 0:x.fillCircle)&&void 0!==w?w:"#dd2e2e")}),stroke:new Te.A({color:null!==(F=null===(P=this.option.style)||void 0===P?void 0:P.colorCircle)&&void 0!==F?F:"#24f22e",width:null!==(E=null===(S=this.option.style)||void 0===S?void 0:S.widthCircle)&&void 0!==E?E:5})}),Point:new y.Ay({image:new ke.A({radius:null!==(A=null===(T=this.option.style)||void 0===T?void 0:T.radiusPoint)&&void 0!==A?A:5,fill:new Ae.A({color:null!==(k=null===(M=this.option.style)||void 0===M?void 0:M.colorPoint)&&void 0!==k?k:"#0324fb"})})})}}hexToRgbAEx(e){const t=e;let i;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return i=t.substring(1).split(""),3===i.length&&(i=[i[0],i[0],i[1],i[1],i[2],i[2]]),i="0x"+i.join(""),"rgba("+[i>>16&255,i>>8&255,255&i].join(",")+",0.2)";throw new Error("Bad Hex")}}function Xe(e){if(e){var t=e.split("/");return 4===t.length?{zoom:parseFloat(t[0]),center:[parseFloat(t[1]),parseFloat(t[2])],rotation:parseFloat(t[3])}:void 0}}function Ye(e,t){var i,n,o,s,r=null!==(i=e.zoom)&&void 0!==i?i:12,a=[348869.291502072,5197452.410915278];"EPSG:4326"===e.projection&&(a=[0,0]);var h=null!==(n=e.center)&&void 0!==n?n:a,l=null!==(o=e.rotation)&&void 0!==o?o:0;if(e.useSynchronizationUrl){var d=new URLSearchParams(window.location.hash.substring(1)).get("map");if(d){if(c=Xe(d))return c}else if(e.useSynchronizationUrl){var c,u=function(e){var t=document.cookie.match(new RegExp("(?:^|; )".concat(e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1"),"=([^;]*)")));return t?decodeURIComponent(t[1]):void 0}(null!==(s="bsr-12"+t)&&void 0!==s?s:"");if(u)if(c=Xe(u))return c}}return{zoom:r,center:h,rotation:l}}var Ze=function(){this.eventMap=new Map},Je=function(){this.eventMap=new Map},We=!0,Ke=function(e,t,i){var n=this;this.popState=function(){We=!1;var e=new URLSearchParams(window.location.hash.substring(1)).get("map");if(e){var t=Xe(e);if(t){var i=n.map.getView();i.setCenter(t.center),i.setZoom(t.zoom),i.setRotation(t.rotation);var o={zoom:i.getZoom(),center:i.getCenter(),rotation:i.getRotation()};window.history.replaceState(o,"map",window.location.hash)}}},this.getHashCore=function(e){var t=new URLSearchParams(window.location.hash.substring(1)),i="/#",n=!1;return t.forEach((function(t,o){"map"!==o?i="/#"===i?i+o+"="+t:i+"&"+o+"="+t:(n=!0,i="/#"===i?i+"map="+e:i+"&map="+e)})),n||(i="/#"===i?i+"map="+e:i+"&map="+e),i},this.updatePermalink=function(){var e;if(We){var t,i,o=n.map.getView(),s=o.getCenter(),r=o.getZoom().toFixed(2)+"/"+s[0].toFixed(2)+"/"+s[1].toFixed(2)+"/"+o.getRotation(),a={zoom:o.getZoom(),center:o.getCenter(),rotation:o.getRotation()};t=null!==(e="bsr-12"+n.id)&&void 0!==e?e:"",i=r,document.cookie="".concat(t,"=").concat(i,"; max-age=25920000"),window.history.pushState(a,"map",n.getHashCore(r))}else We=!0},this.pp23=function(e){null!==e.state&&(n.map.getView().setCenter(e.state.center),n.map.getView().setZoom(e.state.zoom),n.map.getView().setRotation(e.state.rotation),We=!1)},this.Dispose=function(){window.removeEventListener("popstate",n.pp23)},this.map=e,this.option=t,this.id=i,this.map.on("moveend",this.updatePermalink),window.addEventListener("popstate",this.pp23.bind(this)),window.addEventListener("hashchange",this.popState.bind(this))},$e=function(e){function t(t){var i,n=this;return(n=e.call(this,t)||this).mapEventEntEdit=new Ze,n.mapEventCreated=new Je,n.isEdit=!1,n.isCreate=!1,n.isDispose=!1,n.refDivMap=o.createRef(),n.option=null!==(i=n.props.option)&&void 0!==i?i:{},n.id=Ne(),n.styleOsm=new ze(n.option),n.source=new a.A({wrapX:!1,url:n.option.sourceUrl}),n.vector=new f.A({source:n.source,style:n.styleOsm.styleFunction}),n.typles=Object.freeze({NONE:Symbol("None"),POLYGON:Symbol("Polygon"),LINE:Symbol("LineString"),POINT:Symbol("Point"),CIRCLE:Symbol("Circle")}),n.selectAltClick=new S({condition:function(e){(0,w.jM)(e)},filter:function(){return!1}}),n.type=n.typles.POINT,n.draw=new he({source:n.source,type:n.type.description}),n.initMap(),n}return De(t,e),t.prototype.Dispose=function(e){var t,i;this.isDispose||(this.isDispose=!0,this.map.getAllLayers().forEach((function(e){var t;null===(t=e.getSource())||void 0===t||t.dispose(),e.dispose()})),this.map.getView().dispose(),this.map.dispose(),this.syncUnmount&&(this.syncUnmount(),this.syncUnmount=function(){}),this.mapEventEntEdit.eventMap.clear(),this.mapEventCreated.eventMap.clear(),null===(i=null===(t=this.refDivMap.current)||void 0===t?void 0:t.parentNode)||void 0===i||i.removeChild(this.refDivMap.current),e&&e())},t.prototype.initMap=function(){var e=this;setTimeout((function(){var t,i,n=Ye(e.option,e.props.id);if(e.map=new Pe.A({interactions:(0,le.N)().extend([new He(e,e.option)]),layers:[new s.A({source:new r.A}),e.vector],target:null!==(t=e.props.id)&&void 0!==t?t:e.id,view:new Fe.Ay({projection:null!==(i=e.option.projection)&&void 0!==i?i:"EPSG:3857",center:n.center,rotation:n.rotation,zoom:n.zoom})}),e.option.useSynchronizationUrl&&(e.syncUnmount=new Ke(e.map,e.option,e.props.id).Dispose),e.option.removeDoubleClickZoom&&e.map.getInteractions().getArray().forEach((function(t){t instanceof Ee.A&&e.map.removeInteraction(t)})),e.option.onClick&&e.map.on("click",(function(t){var i=e.map.forEachFeatureAtPixel(t.pixel,(function(e){return e}));i?e.option.onClick(e,i,t):e.option.onClick(e,void 0,t)})),e.option.onShowContextMenu&&e.map.getViewport().addEventListener("contextmenu",(function(t){t.preventDefault();var i=e.map.getEventPixel({clientX:t.clientX,clientY:t.clientY}),n=e.map.forEachFeatureAtPixel(i,(function(e){return e}));e.option.onShowContextMenu(e,n,t)})),e.option.useDrawBox){var o=new Se.A({condition:w.k5,className:"box-123"});e.option.onDrawBoxEnd&&o.on("boxend",(function(){var t=o.getGeometry().getExtent(),i=e.source.getFeaturesInExtent(t);e.option.onDrawBoxEnd(e,i,t)})),e.map.addInteraction(o)}})),this.props.featuresAsJson&&this._addFeatureFromJson(this.props.featuresAsJson),this.props.features&&this.source.addFeatures(this.props.features)},t.prototype.GetDivMap=function(){return this.refDivMap.current},t.prototype.GetCurrentEPSGProjection=function(){var e;return null===(e=this.map)||void 0===e?void 0:e.getView().getProjection().getCode()},t.prototype.CancelCreate=function(e){this.map.removeInteraction(this.draw),this.resolvePromise&&(this.resolvePromise(),this.isCreate=!1),e&&e()},t.prototype.Rotation=function(e){var t;null===(t=this.map)||void 0===t||t.getView().setRotation(e)},t.prototype._addFeatureFromJson=function(e,t){var i=(new h.A).readFeatures(e);this.source.addFeatures(i),t&&t()},t.prototype.GetVectorLayer=function(){return this.vector},t.prototype.GetVectorSource=function(){return this.source},t.prototype.GetMap=function(){return this.map},t.prototype.RefreshStyleFeatures=function(){var e=this;this.source.getFeatures().forEach((function(t){t.setStyle(e.styleOsm.styleFunction)}))},t.prototype.RefreshStyleSettings=function(){this.styleOsm.refreshStyleSettings()},t.prototype.SelectFeature=function(e){var t;this.RefreshStyleFeatures(),e.setStyle(null===(t=this.styleOsm)||void 0===t?void 0:t.selectStyle())},t.prototype.SelectFeatures=function(e){var t=this;this.RefreshStyleFeatures(),e.forEach((function(e){var i;e.setStyle(null===(i=t.styleOsm)||void 0===i?void 0:i.selectStyle())}))},t.prototype.GoTo=function(e,t,i){var n=this.map.getView();n.setCenter(e),t&&n.setZoom(t),i&&n.setRotation(i)},t.prototype.GetMapCoordinate=function(){var e=this.map.getView();return{center:e.getCenter(),zoom:e.getZoom(),rotation:e.getRotation()}},t.prototype.GetBound=function(e){var t=this.map.getView().calculateExtent(this.map.getSize()),i={};return i.p1=[t[0],t[3]],i.p2=[t[2],t[3]],i.p3=[t[2],t[1]],i.p4=[t[0],t[1]],i.p5=[t[0],t[3]],e?JSON.stringify(i):i},t.prototype.GetFeatures=function(e){switch(e){case void 0:return this.source.getFeatures();case"Point":return this.source.getFeatures().filter((function(e){var t;return"Point"===(null===(t=e.getGeometry())||void 0===t?void 0:t.getType())}));case"LineString":return this.source.getFeatures().filter((function(e){var t;return"LineString"===(null===(t=e.getGeometry())||void 0===t?void 0:t.getType())}));case"Polygon":return this.source.getFeatures().filter((function(e){var t;return"Polygon"===(null===(t=e.getGeometry())||void 0===t?void 0:t.getType())}));case"Circle":return this.source.getFeatures().filter((function(e){var t;return"Circle"===(null===(t=e.getGeometry())||void 0===t?void 0:t.getType())}))}},t.prototype.AddFeatures=function(e){this.source.addFeatures(e)},t.prototype.AddFeature=function(e){"string"===typeof e?this._addFeatureFromJson(e):this.AddFeatures([e])},t.prototype.DeleteFeature=function(e){this.source.removeFeature(e)},t.prototype.DeleteAllFeatures=function(e){this.source.clear(),this.map.removeInteraction(this.draw),this.resolvePromise&&this.resolvePromise(),e&&e()},t.prototype.GetCenterFeature=function(e){return T.q1(e.getGeometry().getExtent())},t.prototype.GetCoordinateFeature=function(e){var t=e.getGeometry();return t instanceof A.Ay?t.getCoordinates():[]},t.prototype.GetFlatCoordinateFeature=function(e){var t=e.getGeometry();return t instanceof A.Ay?t.getFlatCoordinates():[]},t.prototype.GetOptions=function(){return this.option},t.prototype.Undo=function(){var e;null===(e=this.draw)||void 0===e||e.removeLastPoint()},t.prototype.CreateFeature=function(e){var t=this;return this.CancelCreate(),this.isCreate=!0,new Promise((function(i,n){try{t.mapEventCreated.eventMap.forEach((function(e){e(!0,void 0)})),t.map.removeInteraction(t.selectAltClick),t.map.removeInteraction(t.modify1),t.draw=new he({source:t.source,type:e}),t.resolvePromise=function(){t.mapEventCreated.eventMap.forEach((function(e){e(!1,void 0)})),t.resolvePromise=void 0,i({bsrMap:t,isCancel:!0,feature:void 0,geometry:e})},t.draw.on("drawend",(function(n){t.resolvePromise=void 0;var o=n.feature;t.map.removeInteraction(t.draw),t.isCreate=!1,t.option.onDrawEnd&&t.option.onDrawEnd(t,o),i({bsrMap:t,isCancel:!1,feature:o,geometry:e}),setTimeout((function(){t.mapEventCreated.eventMap.forEach((function(e){e(!1,o)}))}))})),t.map.addInteraction(t.draw)}catch(o){t.isCreate=!1,n(o),setTimeout((function(){t.mapEventCreated.eventMap.forEach((function(e){e(!1,void 0)}))}))}}))},t.prototype.StartEditFeature=function(e,t){var i=this;this.editFeature=e,this.mapEventEntEdit.eventMap.forEach((function(e){e(!0,i.editFeature)})),this.selectAltClick.getFeatures().getLength()>0?this.selectAltClick.getFeatures().clear():(this.selectAltClick.getFeatures().push(e),this.editOnlyRouteOrPolygon()),this.isEdit=!0,t&&t()},Object.defineProperty(t.prototype,"IsEdit",{get:function(){return this.isEdit},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsCreate",{get:function(){return this.isCreate},enumerable:!1,configurable:!0}),t.prototype.AddEvenStateEditingFeature=function(e){var t=Ne();return this.mapEventEntEdit.eventMap.set(t,e),t},t.prototype.RemoveEvenStateEditingFeature=function(e){this.mapEventEntEdit.eventMap.delete(e)},t.prototype.AddEventStateCreatingFeature=function(e){var t=Ne();return this.mapEventCreated.eventMap.set(t,e),t},t.prototype.RemoveEventStateCreatingFeature=function(e){this.mapEventCreated.eventMap.delete(e)},t.prototype.EndEditFeature=function(e){var t=this;this.selectAltClick.getFeatures().clear(),this.isEdit=!1,this.mapEventEntEdit.eventMap.forEach((function(e){e(!1,t.editFeature)})),e&&e(),this.editFeature=void 0},t.prototype.FeatureToJson=function(e){var t=new h.A,i=e.clone();return t.writeGeometry(i.getGeometry())},t.prototype.FeaturesToJson=function(e){return(new h.A).writeFeatures(e)},t.prototype.editOnlyRouteOrPolygon=function(){var e=this;this.modify1=new xe({features:this.selectAltClick.getFeatures()}),this.option.onModifyEnd&&this.modify1.on("modifyend",(function(t){t.features.forEach((function(t){e.option.onModifyEnd(e,t)}))})),this.map.addInteraction(this.modify1),this.map.addInteraction(this.selectAltClick)},t.prototype.RefreshStyleFeature=function(e){e.setStyle(this.styleOsm.styleFunction(e))},t.prototype.componentWillUnmount=function(){this.isDispose||this.syncUnmount&&this.syncUnmount()},t.prototype.componentDidMount=function(){this.mapEventEntEdit.eventMap.clear(),this.mapEventCreated.eventMap.clear()},t.prototype.render=function(){var e,t;return o.createElement("div",{ref:this.refDivMap,className:null!==(e=this.props.className)&&void 0!==e?e:"bsr-map-default",style:this.props.style,id:null!==(t=this.props.id)&&void 0!==t?t:this.id})},t}(o.Component),Qe=function(e){function t(t){return e.call(this,t)||this}return De(t,e),t.prototype.render=function(){var e=this;return o.createElement("div",{onClick:function(){e.props.actionClose()}},this.props.element)},t}(o.Component);function et(e,t){var i=document.createElement("div");i.setAttribute("id","12-23"),i.className="bsr-map-context-menu",i.style.top=e.pageY+"px",i.style.left=e.pageX+"px",i.onmousedown=function(e){e.stopPropagation(),e.preventDefault()};var n=(0,Me.createRoot)(i);function s(){n.render(null),document.body.removeChild(i),document.removeEventListener("mousedown",s)}document.addEventListener("mousedown",s),document.body.appendChild(i),n.render(o.createElement(Qe,{element:t,actionClose:s}))}},32568:()=>{}}]);
//# sourceMappingURL=4053.f6f86039.chunk.js.map